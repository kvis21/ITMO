var m=Object.defineProperty;var x=(c,t,e)=>t in c?m(c,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[t]=e;var o=(c,t,e)=>x(c,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();class b{constructor(){o(this,"dbName","PointsDatabase");o(this,"dbVersion",1);o(this,"storeName","points");o(this,"db",null)}async init(){return new Promise((t,e)=>{const i=indexedDB.open(this.dbName,this.dbVersion);i.onerror=()=>e(i.error),i.onsuccess=()=>{this.db=i.result,t()},i.onupgradeneeded=s=>{const r=s.target.result;if(!r.objectStoreNames.contains(this.storeName)){const n=r.createObjectStore(this.storeName,{keyPath:"id",autoIncrement:!0});n.createIndex("timestamp","timestamp",{unique:!1}),n.createIndex("r","r",{unique:!1})}}})}async addPoint(t){this.db||await this.init();const e={...t,timestamp:Date.now()};return new Promise((i,s)=>{const a=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).add(e);a.onerror=()=>s(a.error),a.onsuccess=()=>i()})}async getAllPoints(){return this.db||await this.init(),new Promise((t,e)=>{const r=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).getAll();r.onerror=()=>e(r.error),r.onsuccess=()=>t(r.result)})}async getPointsByR(t){return this.db||await this.init(),new Promise((e,i)=>{const a=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).index("r").getAll(t);a.onerror=()=>i(a.error),a.onsuccess=()=>e(a.result)})}async clearPoints(){return this.db||await this.init(),new Promise((t,e)=>{const r=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();r.onerror=()=>e(r.error),r.onsuccess=()=>t()})}async deletePoint(t){return this.db||await this.init(),new Promise((e,i)=>{const n=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(t);n.onerror=()=>i(n.error),n.onsuccess=()=>e()})}}const h=class h{constructor(t){o(this,"x",null);o(this,"y",null);o(this,"r",[]);o(this,"isFormValid",!1);this.submitBtn=t,this.initializeEventListeners(),this.updateSubmitButton()}initializeEventListeners(){const t=document.getElementById("x"),e=document.getElementById("y"),i=document.getElementsByName("r"),s=document.getElementById("pointForm");t==null||t.addEventListener("change",this.handleXChange.bind(this)),e==null||e.addEventListener("input",this.handleYChange.bind(this)),i.forEach(r=>{r.addEventListener("change",this.handleRChange.bind(this))}),s==null||s.addEventListener("submit",this.handleFormSubmit.bind(this))}handleXChange(t){const e=t.target;try{const i=parseInt(e.value);this.validateX(i),e.classList.remove("error")}catch{this.x=null,e.classList.add("error")}this.validateForm()}handleYChange(t){const e=t.target;try{const i=parseFloat(e.value);this.validateY(i),e.classList.remove("error")}catch{this.y=null,e.classList.add("error")}this.validateForm()}handleRChange(){this.r=Array.from(document.getElementsByName("r")).filter(t=>t.checked).map(t=>parseFloat(t.value)),document.querySelectorAll(".checkbox-label").forEach(t=>{t.classList.remove("error")}),this.r.length===0&&document.querySelectorAll(".checkbox-label").forEach(t=>{t.classList.add("error")}),this.validateForm()}handleFormSubmit(t){this.isFormValid||(t.preventDefault(),alert("Пожалуйста, заполните все поля корректно перед отправкой"))}validateX(t){if(!h.POSSIBLE_VALUES_X.has(t))throw new Error("Invalid X: X must be one of [-3, -2, -1, 0, 1, 2, 3, 4, 5]");return this.x=t,this.x}validateY(t){if(t<-5||t>3||isNaN(t))throw new Error("Invalid Y: Y must be in range [-5, 3]");return this.y=t,this.y}validateForm(){const t=this.x!==null&&h.POSSIBLE_VALUES_X.has(this.x),e=this.y!==null&&this.y>=-5&&this.y<=3,i=this.r.length>0&&this.r.every(s=>h.POSSIBLE_VALUES_R.has(s));this.isFormValid=t&&e&&i,this.updateSubmitButton()}updateSubmitButton(){this.isFormValid?(this.submitBtn.disabled=!1,this.submitBtn.classList.remove("disabled")):(this.submitBtn.disabled=!0,this.submitBtn.classList.add("disabled"))}getFormData(){return this.isFormValid?{x:this.x,y:this.y,r:this.r}:null}get isValid(){return this.isFormValid}};o(h,"POSSIBLE_VALUES_X",new Set([-3,-2,-1,0,1,2,3,4,5])),o(h,"POSSIBLE_VALUES_R",new Set([1,1.5,2,2.5,3]));let l=h;class g{constructor(t){o(this,"canvas");o(this,"ctx");o(this,"BASE_R",100);o(this,"centerX");o(this,"centerY");o(this,"activeAnimations",new Map);o(this,"animationFrameId",null);o(this,"animationTimeout",3e3);const e=document.getElementById(t);if(!e)throw new Error(`Canvas with id ${t} not found`);const i=getComputedStyle(e);e.width=parseInt(i.width)+150,e.height=parseInt(i.height)+150,this.canvas=e;const s=this.canvas.getContext("2d");if(!s)throw new Error("Could not get 2D context");this.ctx=s,this.centerX=this.canvas.width/2,this.centerY=this.canvas.height/2,this.startAnimationLoop(),this.drawGraph()}startAnimationLoop(){const t=()=>{this.drawGraph(),this.animationFrameId=requestAnimationFrame(t)};t()}showFigure(t){if(this.activeAnimations.size>=5){const i=this.activeAnimations.keys().next().value;i!==void 0&&this.activeAnimations.delete(i)}this.activeAnimations.set(t,{opacity:0,points:[]});const e=()=>{const i=this.activeAnimations.get(t);i&&(i.opacity<1?(i.opacity+=.05,setTimeout(e,50)):setTimeout(()=>this.hideFigure(t),this.animationTimeout))};e()}hideFigure(t){const e=()=>{const i=this.activeAnimations.get(t);i&&(i.opacity>0?(i.opacity-=.05,setTimeout(e,50)):this.activeAnimations.delete(t))};e()}drawGraph(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.activeAnimations.forEach((t,e)=>{this.drawFigure(this.BASE_R*e,t.opacity,t.points)}),this.drawAxes(),this.drawLabels()}drawFigure(t,e,i){this.ctx.save(),this.ctx.globalAlpha=e,this.ctx.fillStyle=`rgba(61, 211, 248, ${.79*e})`,this.ctx.strokeStyle=`rgba(0, 100, 200, ${e})`,this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.rect(this.centerX-t,this.centerY-t/2,t,t/2),this.ctx.fill(),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.centerX,this.centerY),this.ctx.arc(this.centerX,this.centerY,t,0,Math.PI/2,!1),this.ctx.lineTo(this.centerX,this.centerY),this.ctx.fill(),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.centerX,this.centerY),this.ctx.lineTo(this.centerX-t/2,this.centerY),this.ctx.lineTo(this.centerX,this.centerY+t/2),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),this.ctx.globalAlpha=1,i.forEach(s=>{const r=this.BASE_R,n=this.centerX+s.x*r,a=this.centerY-s.y*r;this.ctx.beginPath(),this.ctx.arc(n,a,4,0,2*Math.PI),this.ctx.fillStyle=s.result?"green":"red",this.ctx.fill(),this.ctx.strokeStyle="black",this.ctx.lineWidth=1,this.ctx.stroke()}),this.drawFigureLabels(t,e),this.ctx.restore()}drawFigureLabels(t,e){this.ctx.save(),this.ctx.globalAlpha=e,this.ctx.font="10px monospace",this.ctx.fillStyle="black",t/this.BASE_R,this.ctx.restore()}drawAxes(){this.ctx.save(),this.ctx.globalAlpha=1,this.ctx.strokeStyle="black",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(this.centerX,0),this.ctx.lineTo(this.centerX,this.canvas.height),this.ctx.moveTo(0,this.centerY),this.ctx.lineTo(this.canvas.width,this.centerY),this.ctx.stroke();const t=[.5,1,1.5,2,2.5,3],e=6;t.forEach(i=>{const s=this.BASE_R*i;this.ctx.beginPath(),this.ctx.moveTo(this.centerX+s,this.centerY-e),this.ctx.lineTo(this.centerX+s,this.centerY+e),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.centerX-s,this.centerY-e),this.ctx.lineTo(this.centerX-s,this.centerY+e),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.centerX-e,this.centerY-s),this.ctx.lineTo(this.centerX+e,this.centerY-s),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.centerX-e,this.centerY+s),this.ctx.lineTo(this.centerX+e,this.centerY+s),this.ctx.stroke()}),this.ctx.restore()}drawLabels(){this.ctx.save(),this.ctx.globalAlpha=1,this.ctx.font="14px Arial",this.ctx.textAlign="center",this.ctx.fillStyle="red",this.ctx.fillText("X",this.canvas.width-15,this.centerY-15),this.ctx.fillText("Y",this.centerX+15,15),this.ctx.fillText("0",this.centerX+6,this.centerY-6),this.ctx.fillStyle="black",this.ctx.font="10px Arial",[.5,1,1.5,2,2.5,3].forEach(e=>{const i=this.BASE_R*e;this.ctx.fillText(`${e}R`,this.centerX+i,this.centerY-10),this.ctx.fillText(`-${e}R`,this.centerX-i,this.centerY-10),this.ctx.fillText(`${e}R`,this.centerX+15,this.centerY-i+4),this.ctx.fillText(`-${e}R`,this.centerX+20,this.centerY+i+4)}),this.ctx.restore()}drawPoint(t,e,i,s){const r=this.activeAnimations.get(s);r?r.points.push({x:t,y:e,result:i}):(this.showFigure(s),setTimeout(()=>{const n=this.activeAnimations.get(s);n&&n.points.push({x:t,y:e,result:i})},100))}clearPoints(){this.activeAnimations.clear(),this.drawGraph()}destroy(){this.animationFrameId&&cancelAnimationFrame(this.animationFrameId)}get_animationTimeout(){return this.animationTimeout}}class f{constructor(){o(this,"validator");o(this,"graph");o(this,"resultTable");o(this,"pointsDB");const t=document.querySelector(".submit-btn");if(!t)throw new Error("Submit button not found");this.validator=new l(t),this.graph=new g("graphCanvas"),this.resultTable=document.getElementById("resultsTable"),this.pointsDB=new b,this.initializeEventListeners(),this.loadStoredResults()}initializeEventListeners(){const t=document.getElementById("pointForm");t==null||t.addEventListener("submit",this.handleFormSubmit.bind(this))}async handleFormSubmit(t){t.preventDefault();const e=this.validator.getFormData();if(!e)return;const i=new URLSearchParams({x:e.x.toString(),y:e.y.toString(),listR:e.r.join(",")});console.log("Sending request with params:",i.toString());try{const s=await fetch(`/fcgi-bin/FastCGIApp.jar/calculate?${i.toString()}`,{method:"GET",headers:{Accept:"application/json"}});await this.handleResponse(s,e)}catch(s){console.error("Request failed:",s),this.addErrorToTable("Network error")}}async handleResponse(t,e){const i={x:e.x,y:e.y,time:""};if(t.ok){const s=await t.json();this.graph.drawGraph();for(let r=0;r<e.r.length;r++){const n={...i,r:e.r[r].toString(),result:s.results[r].toString(),time:new Date(s.now).toLocaleString(),execTime:`${s.time} ns`};this.graph.showFigure(e.r[r]),this.graph.drawPoint(e.x,e.y,s.results[r],e.r[r]),this.addResultToTable(n),await this.pointsDB.addPoint(n),r<e.r.length-1&&await new Promise(a=>setTimeout(a,this.graph.get_animationTimeout()+2e3))}}else if(t.status===400){const s=await t.json(),r={...i,r:"N/A",result:`error: ${s.message}`,time:new Date(s.now).toLocaleString(),execTime:"N/A"};this.addResultToTable(r)}else{const s={...i,r:"N/A",result:"error",time:"N/A",execTime:"N/A"};this.addResultToTable(s)}}addResultToTable(t){const e=this.resultTable.insertRow(-1),i=e.insertCell(0),s=e.insertCell(1),r=e.insertCell(2),n=e.insertCell(3),a=e.insertCell(4),u=e.insertCell(5);if(i.textContent=t.x.toString(),s.textContent=t.y.toString(),r.textContent=t.r,a.textContent=t.time,u.textContent=t.execTime,t.result.includes("error"))n.textContent=t.result,n.className="result-error";else{const d=t.result==="true"||t.result==="Попадание";n.textContent=d?"Попадание":"Непопадание",n.className=d?"result-hit":"result-miss"}e.scrollIntoView({behavior:"smooth",block:"nearest"})}addErrorToTable(t){const e={x:0,y:0,r:"N/A",result:t,time:"N/A",execTime:"N/A"};this.addResultToTable(e)}async loadStoredResults(){try{await this.pointsDB.init();const t=await this.pointsDB.getAllPoints();t.sort((e,i)=>e.timestamp-i.timestamp),t.forEach(e=>{this.addResultToTable(e)})}catch(t){console.error("Failed to load stored results:",t)}}async clearAllData(){try{await this.pointsDB.clearPoints(),this.graph.clearPoints();const t=this.resultTable.querySelector("tbody");if(t){t.remove();const e=document.createElement("tbody");this.resultTable.appendChild(e)}console.log("All data cleared successfully")}catch(t){throw console.error("Failed to clear data:",t),t}}}document.addEventListener("DOMContentLoaded",()=>{try{new f}catch(c){console.error("Failed to initialize application:",c)}});
